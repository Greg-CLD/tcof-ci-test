REPLIT AGENT PROMPT – Admin Link + Block 2 Workflow Fix
sql
Copy
Edit
We have two final issues to resolve:

────────────────────────────────────────
1️⃣  ADD FACTOR-EDITOR LINK ON MAIN ADMIN PAGE

• Page /make-a-plan/admin should list quick-links to all admin sub-sections.
  – Add a visible button or card labelled **“Manage Success Factors & Tasks”**
    that routes to **/make-a-plan/admin/factors**.
  – Place it directly under the existing Admin Preset link, using the same
    card style.

• Ensure SiteHeader or any global nav also contains this link when a user is
  authenticated as admin (greg@confluity.co.uk, case-insensitive).

────────────────────────────────────────
2️⃣  REWORK BLOCK 2 TO MATCH SPEC AND REMOVE IMPORT SECTION

*Current problems:*  
  – An “Import Tasks from Database” panel shows up (not wanted).  
  – “No personal heuristics found” appears even when they exist.  
  – Production still white-screens on /block-2.

Implement the intended Block 2 flow:

----------------------------------------------------
Step 3 – Link (Optional)
----------------------------------------------------
• For every personal heuristic captured in Block 1, let the user optionally
  pick one of the 12 canonical TCOF success factors from a dropdown.
• Show a “Skip for now” button that bypasses this step.

----------------------------------------------------
Step 4 – Identify Tasks per Heuristic
----------------------------------------------------
• Once heuristics are listed (and optionally linked), show a table:
     Heuristic | Stage | Task 1 | Task 2 | Task 3
• Limit to max 3 tasks per stage per heuristic.
• Any tasks typed here go straight to the in-progress plan and appear in the
  Checklist page by default.
• Remove the “Import Tasks from Database” panel entirely.

----------------------------------------------------
Step 5 – Organisation Policy Tasks
----------------------------------------------------
• Provide a simple form:
     – Textarea for task description
     – Stage dropdown (Identification / Definition / Delivery / Closure)
     – “Add” button to push the task to the plan.
• Skip button allowed.

────────────────────────────────────────
OTHER FIXES

• Fix the “No personal heuristics found” error:
  – Only show if `personalHeuristics.length === 0`.
• Add try/catch around Block2 data load to stop white‐screen in production and
  log any error to console.
• Ensure Block 2 JSX no longer imports or references the removed
  “Import Tasks” component.

────────────────────────────────────────
TESTS

• tests/adminLink.test.tsx  
  – Render /make-a-plan/admin, assert link text
    “Manage Success Factors & Tasks” exists and routes correctly.

• tests/block2.flow.test.tsx  
  – Mock plan with one personal heuristic.  
  – Render Block 2; expect no “Import Tasks” panel, no error banner, and
    Step 3 appears.  
  – Add a task in Step 4, click Next → ensure task now exists in plan.

────────────────────────────────────────
FILES TO UPDATE

• pages/AdminHome.tsx (add link card)  
• components/SiteHeader.tsx (conditional nav link)  
• pages/Block2Connect.tsx (re-implement Steps 3-5, remove Import panel)  
• utils/planHelpers.ts (ensure tasks from Step 4/5 are saved)  
• tests as above

After deployment:

✔  /make-a-plan/admin shows the new “Manage Success Factors & Tasks” link  
✔  Block 2 loads without a white screen, shows only Steps 3-5 as specified  
✔  “Import Tasks from Database” panel is gone  
✔  Adding tasks in Block 2 shows them in the final checklist

End of prompt.