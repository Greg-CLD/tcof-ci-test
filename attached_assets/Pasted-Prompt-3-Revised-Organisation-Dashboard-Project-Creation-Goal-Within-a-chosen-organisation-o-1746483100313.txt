Prompt 3 (Revised) â€” Organisation Dashboard & Project Creation
Goal
Within a chosen organisation (/organisations/:orgId), show its projects and let members spin up new ones that inherit the orgâ€™s default heuristics. Use the new navigation pattern (redirects via navigate()) and ensure all links work.

âœ… Checklist
Routing & Redirects

App.tsx:

tsx
Copy
Edit
// inside your Router componentâ€™s useEffect:
useEffect(() => {
  if (user && location === '/organisations') {
    // let them use the org list
    return;
  }
  if (user && location === `/organisations/${orgIdParam}`) {
    // allow dashboard
    return;
  }
  // any other auth-route guard
}, [user, location, navigate]);
Add route for dashboard:

jsx
Copy
Edit
<Route path="/organisations/:orgId">
  {user ? (
    <ProtectedRouteGuard>
      <OrganisationDashboardPage />
    </ProtectedRouteGuard>
  ) : (
    navigate('/')
  )}
</Route>
Use useParams() (or Wouterâ€™s equivalent) to pull orgId.

OrganisationDashboardPage Component

Location: client/src/pages/OrganisationDashboardPage.tsx

Data Fetch:

ts
Copy
Edit
const { orgId } = useParams();
const { data: projects = [], isLoading: pLoading } = useQuery(
  ['orgProjects', orgId],
  () => apiRequest('GET', `/api/organisations/${orgId}/projects`).then(r => r.json())
);
const { data: defaults = [], isLoading: dLoading } = useQuery(
  ['orgDefaults', orgId],
  () => apiRequest('GET', `/api/organisations/${orgId}/heuristics`).then(r => r.json())
);
Render:

Org name and description (from props or another query).

â€œProjectsâ€ section:

Spinner while pLoading; error toast on failure.

If projects.length === 0, show â€œNo projects yet. Create one to get started.â€

Otherwise list project cards with clickable titles (navigate(/projects/${project.id})).

â€œNew Projectâ€ Flow

Button â€œNew Projectâ€ always visible:

jsx
Copy
Edit
<Button onClick={() => setModalOpen(true)}>New Project</Button>
Modal or inline form fields:

Project Name (required text input).

On submit:

ts
Copy
Edit
await apiRequest('POST', '/api/projects', {
  name,
  organisationId: orgId
});
Rely on backend to clone organisation_heuristics into project_heuristics.

After success:

navigate('/organisations/'+orgId, { replace: true }) or simply refetch the projects query.

Show success toast.

Navigation & Buttons

In the dashboard, use direct navigate('/organisations') or navigate(/projects/${id}) callsâ€”no nested <Link>.

Ensure any back or home buttons use navigate().

Error Handling & Loading

Disable â€œNew Projectâ€ button while request in flight.

Show inline spinners/loading indicators for both queries and mutations.

Show error toasts on failures.

âœ… Definition of Done
Navigating to /organisations/:orgId (via nav or URL) shows the orgâ€™s name, defaults loaded, and project list.

â€œNew Projectâ€ opens a form, creating a project tied to orgId and inheriting defaults; it appears immediately without broken links.

All navigation uses navigate() callsâ€”no broken <Link> or double redirects.

ğŸ§ª Smoke Tests
Dashboard Load

Sign in â†’ click â€œOrganisationsâ€ â†’ select an org â†’ land on its dashboard.

Spinner appears then projects list (or empty-state).

Create Project

Click New Project, enter name â†’ project appears in list.

URL remains /organisations/:orgId.

Link Behavior

Click project card â†’ navigate to /projects/:projectId.

Browser â€œBackâ€ returns to /organisations/:orgId.

Auth Guard

Log out â†’ hit /organisations/:orgId â†’ redirect to /.